{% extends "DogeFacebookBundle:Layout:layout.html.twig" %}

{% block content %}
    {% if error is defined and error is not empty %}
        {{ error }}
    {% else %}
    {{ message }}
    Je télécharge une photo depuis mon ordinateur :

    <br />
    {{ form( form ) }}

    Ou je choisis une photo depuis mes albums facebook :
        <form method="post" id="user-photos">
        </form>
    {% endif %}
{% endblock %}

{% block js %}
    {{ parent() }}
    {% if error is not defined or error is empty %}
    <script src="{{ asset("bundles/dogefacebook/js/upload.js") }}"></script>
    <script type="text/javascript">
        if( $("#form_album").val() == 0 ){
            $("#form_albumName").attr("type", "text");
        }

        $("#form_album").change(function(){
            if( $(this).val() == 0 ){
                $("#form_albumName").attr("type", "text");
            } else {
                $("#form_albumName").attr("type", "hidden");
            }
        });

        $(document).ready(function() {
            $.ajaxSetup({ cache: true });
            $.getScript('//connect.facebook.net/fr_FR/sdk.js', function(){
                FB.init({
                    appId: '{{ app_id }}',
                    version: 'v2.3' // or v2.0, v2.1, v2.0
                });

                FB.login(function(response) {
                    console.log(response);
                    if (response.authResponse) {
                        var access_token =   FB.getAuthResponse()['accessToken'];
                        console.log('Access Token = '+ access_token);
                        FB.api('/me', function(response) {
                            console.log('Good to see you, ' + response.name + '.');
                        });
                    } else {
                        console.log('User cancelled login or did not fully authorize.');
                    }
                }, { scope: "{{ scopes }}" });

                console.log( FB.getLoginStatus() );

                FB.api('/me/albums?fields=id,name', function(response) {
                    var data = response.data;
                    console.log(response);
                    console.log(response.data);
                });
            });
        });
    </script>
    {% endif %}
{% endblock %}